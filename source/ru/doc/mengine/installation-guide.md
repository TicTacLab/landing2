---
title: MathEngine: Инструкция по установке 
---

# Инструкция по установке

В данном документе описана инструкция по установке MathEngine.
Установка MathEngine разделена на 4 части:
  1. Установка Cassandra
  2. Установка MathEngine (движок расчетов)
  3. Установка MathAdmin (сайт администратор)
  4. Установка балансировщика
  
## Установка Cassandra
MathEngine использует базу данных Cassandra 2.0 для хранения информации
и загруженных файлов.

Рекоммендованные системные требования:
  * 5 узлов в кластере на дата центр
  * 16GB оперативной памяти
  * 8 x CPU (2.6 GHz)
  * 500GB дискового пространства
  
Для того, чтобы установить Cassandra на каждом из узлов необходимо проделать шаги
описаны на (данной странице)[http://docs.datastax.com/en/cassandra/2.0/cassandra/install/install_cassandraTOC.html].

Также можно настроить систему логгирования. Подпробней об этом написано
(здесь)[http://docs.datastax.com/en/cassandra/2.0/cassandra/configuration/configLoggingTOC.html].

Для детальной конфигурации выделения памяти Cassandra можно почитать
(здесь)[http://docs.datastax.com/en/cassandra/2.0/cassandra/operations/ops_tune_jvm_c.html].

Для запуска Cassandra необходимо следовать шагам описанным на
(данной странице)[http://docs.datastax.com/en/cassandra/2.0/cassandra/initialize/initializeTOC.html].
На этой странице сначала нужно выбрать тип установки:
  * с одним дата центром
  * несколько дана центров

Рекоммендуемая установка на несколько дата центров. Но для удешевления и боллее быстрого
старта можно выбрать установка с одним дата центром. Такая установка не будет гарантировать
работоспособность приложения в случае ЧП в дата центре.

Если установка прошла успешно, то необходимо приступить к созданию схемы в Cassandra.
Архив schema-<version>.zip, в котором находяться необходимые файлы
для создания схемы в Cassandra, необходимо распаковать. 
Для того, чтобы использовать эти файлы, нужно 
поправить в них некоторые параметры:
  * строку "<cluster-size>" нужно заменить на количество
    узлов в вашем кластере.

После этого, необходимо выполнить комманду на ОДНОМ компьютере на котором установлена
Cassandra. Проделывать эту операцию на других компьютерах не нужно.
  $ cqlsh -u <пользователь> -p <пароль> -f keyspace.cql <ip адрес cassandra>
  $ cqlsh -u <пользователь> -p <пароль> -f schema.cql <ip адрес cassandra>
  
## Установка MathEngine
MathEngine это вычислительный движок для Excel файлов. 
Для установки MathEngine необходимо установить Oracle Java Development Kit (JDK) 1.7+.
Инструкцию по данной установке можно почитать на этой 
(странице)[http://docs.oracle.com/javase/7/docs/webnotes/install/].

После установки JDK необходимо выполнить следующие инструкции:
  1. Распаковать инсталяционный архив math_engine-<version>.zip.
  2. В папке math_engine-<version>/conf открыть файл config.json и выполнить конфигурацию сервиса:
    * port - Порт, на котором будем запущен сервис
    * host - Адресс, по которому сервис будет доступени
    * cache-on - Если true, то MathEngine будет использовать кеши при одинаковых запросах,
      иначе, на каждый запрос будет производиться расчет
    * session-ttl - Время существование сессии, если по ней нет активных соединений
    * storage-keyspace - Имя пространства имен в Cassandra. Если при заливке схемы 
      это не изменялось, то оставить стадартное значение
    * storage-nodes - Список узлов Cassandra
    * storage-user - Имя пользователя к Cassandra 
    * storage-password - Пароль для пользователя к Cassandra
    * monitoring-hostname - имя хоста для мониторинга в системе Zabbix
    * zabbix-hostname - Адресс сервера мониторинга Zabbix
    * zabbix-port - Порт сервера мониторинга Zabbix
    * noilly-port - Порт подсервиса конфигурации. Лучше оставить это значение стандартным.
  3. Если необходимо, настроить систему логирования. Для этого нужно править файл
     math_engine-<version>/conf/logger-conf.xml. Синтаксис этого файла подробно описан
     (здесь)[http://logback.qos.ch/manual/index.html]. MathEngine со стандартной настройкой
     логирования будет писать логи в папку math_engine-<version>/log.
  4. После этого можно запускать MathEngine с помощью комманды
     $ bin/math_engine.sh
     После этого через несколько секунд должна появиться надпись: "MathEngine is started!".
  5. MathEngine готов к использованию.
  
## Установка MathAdmin
MathAdmin - это интерфейс, который упрощает работу над файлами с MathEngine.    
  
Для установки MathEngine необходимо установить Oracle Java Development Kit (JDK) 1.7+.
Инструкцию по данной установке можно почитать на этой 
(странице)[http://docs.oracle.com/javase/7/docs/webnotes/install/].
  
После установки JDK необходимо выполнить следующие инструкции:
  1. Распаковать инсталяционный архив math_admin-<version>.zip.
  2. В папке math_admin-<version>/conf открыть файл config.json и выполнить конфигурацию сервиса:
    * app-env - режим, в котором будет запущен сервис. Не стоит его менять без необходимости, 
      т.к. приложение перестанет работать в привычном режиме
    * port - Порт, на котором будем запущен сервис
    * host - Адресс, по которому сервис будет доступени
    * session-ttl - Время существование сессии в интерфейсе администратор, если пользователь не активный.
    * storage-keyspace - Имя пространства имен в Cassandra. Если при заливке схемы 
      это не изменялось, то оставить стадартное значение
    * storage-nodes - Список узлов Cassandra
    * storage-user - Имя пользователя к Cassandra 
    * storage-password - Пароль для пользователя к Cassandra
    * m-engine-api-addr - Адрес с портом MathEngine или балансировщика.
      Если вы используйте балансировщик, тогда заполните это поле после его установки 
      и конфигурации. Если вы будете использовать стандартные настройки балансировщика,
      то этот адрес будет похож на "<balancer_address>:<balancer_port>/api".
    * monitoring-hostname - имя хоста для мониторинга в системе Zabbix
    * zabbix-hostname - Адресс сервера мониторинга Zabbix
    * zabbix-port - Порт сервера мониторинга Zabbix
    * noilly-port - Порт подсервиса конфигурации. Лучше оставить это значение стандартным.
  3. Если необходимо, настроить систему логирования. Для этого нужно править файл
     math_engine-<version>/conf/logger-conf.xml. Синтаксис этого файла подробно описан
     (здесь)[http://logback.qos.ch/manual/index.html]. MathEngine со стандартной настройкой
     логирования будет писать логи в папку math_engine-<version>/log. Также, журнал действий
     пользователей будет писаться в файл math_engine-<version>/log/audit.log
  4. После этого можно запускать MathAdmin с помощью комманды
       $ bin/math_admin.sh
       После этого через несколько секунд должна появиться надпись: "MathAdmin is started!".
  5. MathAdmin готов к использованию.
  
## Установка балансировщика
Если имееться несколько узлов MathEngine, балансировщик способен соединить их
в единый кластер и равномерно распределять нагрузку на каждый из них.
В качестве балансировщика используеться сервер nginx.

Для установки и настройки балансировщика необходимо пройти следующие шаги:
  1. Скачать и установить nginx последней версии. Для этого можно использовать
  данную (страницу)[https://www.nginx.com/resources/wiki/start/topics/tutorials/install/].
  2. Распакуйте архив balancer-<version>.zip
  3. Отредактируйте файл math_engine.conf, который находиться в архиве
  4. Включите эту конфигурацию в nginx. Этот шаг специфичен для разных операционных систем.
  5. Запустите nginx
  6. Балансировщик готов к использованию