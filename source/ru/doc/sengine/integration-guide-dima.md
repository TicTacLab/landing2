---
title: Settlement Engine. Руководство по интеграции
---

## Settlement Engine

# Руководство по интеграции

# Введение

В данном документе описан порядок работы с Settlement Egnine REST API. Предполагается, что Excel файл уже [подготовлен](/ru/doc/sengine/file-preparation/) и загружен посредством [Административного интерфейса](/ru/doc/user-guide/).

# Использование Settlement Engine REST API 

Использование Settlement Engine REST API состоит из нескольких шагов:

1. [Создание события с уникальным](#event-create) *event-id*.
2. [Заполнение журнала событий](#event-log) В ответ Settlement Engines отправит расчитанные значения исходов из вкладки "OUT". Этот шаг повторяется до окончания события.
3. [Освобождение ресурсов](#release) после окончания события. 

А теперь о каждом шаге детальнее. 

{:#event-create}
# Создание события с уникальным *event-id*

Для накопления событий в журнале матча, SEngine виртуально создает копию Excel файла для каждого матча. Каждый матч в SEngine использует два идентификатора:

* event-id
* file-id

# Заполнение журнала событий

В журнале должны хранится все результаты и события матча необходимые для расчета исходов.  
Журнал можно заполнять с помощью *добавления* событий либо *перезаписью* всего журнала.
 
* Добавление  событий в журнал используюется при стандартом проведении матча. 
* Перезапись  журнала - эта операция понадобится в случае необходимости пересчитать весь матч, к примеру при отмене гола.

{:#release}
# Освобождение ресурсов
После окончания события следует освободить ресурсы вызвав метод *RELEASE*. Также ресурсы освобождаются автоматически по истечении 15 минут, если к событию не было ни одного обращения за этот период. 

# Settlement Engine REST API

## Введение

Любой запрос может вернуть ошибку **500 "ISE"** в случае внутренних ошибок системы. Если сервис не доступен возвращается ошибка **503 "STU"**. Все ответы BetEngines имеют Content-Type: "application/json". У ответа 204 нет содержимого, как в спецификации к протоколу HTTP.

**Структура ответа**

~~~ javascript
{
  "status": 200,
  "data": null // или {} или [] в зависимости от запроса
}
~~~

**Структура ошибки**

~~~ json
{
  "status": 423,
  "errors": 
  [
    {
      "code": "CIP",
      "message": "Calculation in progress"
    }
  ]
}
~~~

## Method: EVENTS

**POST /api/events**

Предназначен для создания матча с уникальным event-id

**Parameters**

* file-id - обязательно, ID Excel файла, по которому будет проводится событие
* event-id - обязательно, уникальный ID события

**Responses**

* 200 - успешное создание матча
* 400 "EAC" - сессия уже создана
* 404 "FNF" - файл не найден

**Request body**

~~ json

{"params" : 
   {"file-id" : 120
    "event-id" : "ssid"}}
~~
 
**Request example** <a href="#curl">*<a/> 

~~~
curl -X POST -d <<json-request-body>> http://s.engine/api/events
~~~
  
**Response examples**

~~~
"Session created succesfully"
~~~

В случае попытки создания сессии для существующего события, ответ от сервера будет:
 
~~~
"Event with id '%s' is already created"
~~~
 
## Method: EVENT-LOG

**GET /api/events/:event-id/event-log**

** Parameters **

event-id - обязательно, уникальный ID события

**Request example** <a href="#curl">*<a/>

~~~
curl http://s.engine/api/events/120/event-log
~~~

